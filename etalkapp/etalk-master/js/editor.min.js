function notifyChange(e){e.closest("form").addClass("dirty"),$("#btnSave").addClass("dirty")}function showImageForm(e,t){return currentFormInput=e,currentButtonForImageEdit=$(t),currentFormForImageEdit=currentButtonForImageEdit.closest("form"),currentFileName=currentFormForImageEdit.find("input[name=file]").val(),""===currentFileName?resetFile(e.substring(9)):showFile(e.substring(9),currentFileName,!1),fileFormCopy(currentFormForImageEdit,$("#fileEdit")),$("#fileEdit").fadeIn(),!1}function fileFormCopy(e,t){t.find("input[name=file_credits]").val(e.find("input[name=file_credits]").val()),t.find("input[name=file_link]").val(e.find("input[name=file_link]").val())}function closeImageForm(e){if(e){var t=$("#"+currentFormInput).val();currentFormForImageEdit.find("input[name=file]").val(t),fileFormCopy($("#fileEdit"),currentFormForImageEdit),notifyChange(currentFormForImageEdit),""!==t?currentButtonForImageEdit.addClass("filled"):currentButtonForImageEdit.removeClass("filled")}return $("#fileEdit").fadeOut(),!1}function updatePreviewContents(){$("#previewContents>div").html('<img src="/i/loading.gif" class="loading" />'),$.getJSON("index.php",{f:"getStructure",dir:$("header form select[name=dir]").val()},function(e){for(var t="",n=0;n<e.data.length;n++){t+='<a href="#c'+n+'"><h2>'+e.data[n].title+"</h2>";for(var r=e.data[n].p.length,i=0;r>i;i++)t+='<p class="'+e.data[n].p[i].type+'">'+e.data[n].p[i].text+"</p>";t+="</a>"}$("#previewContents>div").html(t),$("#previewContents a").click(function(){$("#previewContents").fadeOut()})})}function structureChanged(){$(".pSepTarget.section").each(function(e){$(this).attr("id","c"+e)}),updatePreviewContents()}function save(e,t){var n=e.serialize();return $.post("?save=",n,function(e){void 0!==t&&t.apply(this,arguments)}),!1}function saveAll(){$("form.dirty").each(function(){save($(this),function(){structureChanged()}),$(this).removeClass("dirty")}),$("#btnSave").removeClass("dirty")}function keepAlive(){$.get("index.php",{f:"keepAlive"})}function setDragTarget(e,t){clearTimeout(lockDragTargetTimer),t.stop(!1,!0),e?t.addClass("targetLocked",kDragLockAnimDuration):t.removeClass("targetLocked",kDragLockAnimDuration)}function initDroppables(){$(".pSepTarget.ui-droppable").droppable("destroy"),$(".pSepTarget.continue").droppable({accept:$(".separator"),drop:function(e,t){var n=t.helper.data("type");t.helper.remove(),$(this).addClass(n,kDragLockAnimDuration),$(this).find("input[name=chaptering]").val(n),$(this).droppable("disable"),structureChanged(),notifyChange($(this))},over:function(e,t){lockDragTargetTimer=setTimeout(function(){setDragTarget(!0,t.helper)},kDragLockDelay)},out:function(e,t){setDragTarget(!1,t.helper)}})}function removeSeparator(e){var t=e.parent(".pSepTarget");t.find("input[name=section_title]").val(""),t.find("input[name=chaptering]").val("continue"),t.removeClass("section paragraph",kRemoveAnimationDuration).addClass("continue",kRemoveAnimationDuration),notifyChange(t),initDroppables()}var kKeepAliveInterval=12e4,currentButtonForImageEdit=null,currentFormForImageEdit=null,currentFormInput=null,lockDragTargetTimer=null,kDragLockDelay=400,kDragLockAnimDuration=200,kRemoveAnimationDuration=300;$(document).ready(function(){$("#tools .separator").draggable({axis:"y",helper:"clone",revert:"invalid",scroll:!0,snap:".pSepTarget.continue",snapMode:"inner",snapTolerance:20}),initDroppables(),$(".pSepTarget>img").click(function(){removeSeparator($(this))}),$("input,textarea").bind("input",function(){notifyChange($(this))}),$("#btnSave").click(function(){saveAll()}),$("#btnPreviewContents").click(function(){$("#previewContents").fadeToggle("fast")}),structureChanged(),setInterval(function(){keepAlive()},kKeepAliveInterval)});
//# sourceMappingURL=./editor.min.js.map
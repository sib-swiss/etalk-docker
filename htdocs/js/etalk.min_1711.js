function play(){$("#bPlay").hide();document.getElementById("bPause").style.display="inline";player.play();$("body.viewer").removeClass("paused");$("#wait").fadeOut(function(){});return!1}function pause(e){document.getElementById("bPlay").style.display="inline";$("#bPause").hide();player.pause();e&&$("#wait").fadeIn(function(){$("body.viewer").addClass("paused")});return!1}function startedPlay(){$("html, body").animate({scrollTop:$("#a"+currentSnd).offset().top-50},1e3)}function endedPlay(){next()}function setCurrentSnd(e){currentSnd=e;location.hash=e;player.src="data/"+audioFiles[currentSnd].snd;$("#viz a").removeClass("current");$("#a"+currentSnd).addClass("current");"/tmp/"+audioFiles[currentSnd]["pict"]!=$("#diaPict").attr("src")&&$("#dia>figure").fadeOut(kFadeDuration,function(){var e;if(audioFiles[currentSnd].pict!==""){$("#diaPict").attr("src","/tmp/"+audioFiles[currentSnd].pict);e="";audioFiles[currentSnd].pict_cred.length>0?e+="Â© "+audioFiles[currentSnd].pict_cred:e+=audioFiles[currentSnd].pict_cred;audioFiles[currentSnd]["pict_link"]!=""&&(e+='<br/><a href="'+audioFiles[currentSnd].pict_link+'" target="_blank">'+audioFiles[currentSnd].pict_link+"</a>");$("#dia>figure>figcaption").html(e);$("#dia>figure").fadeIn()}});$("#links").fadeOut(kFadeDuration,function(){if(audioFiles[currentSnd].link!==""){$("#links").html(audioFiles[currentSnd].link);$("#links").fadeIn()}});$("#links a.entity").bind("click touchstart",function(e){e.preventDefault();e.stopPropagation();openLink($(this).attr("href"))})}function playTrack(e){player.pause();setCurrentSnd(parseInt(e,10));play();return!1}function next(){if(currentSnd<audioFiles.length-1){setCurrentSnd(parseInt(currentSnd,10)+1);play()}else alert("End of the track.");return!1}function openLink(e){pause(!1);$("#overlay iframe").attr("src",e);$("#overlay").fadeIn();return!1}function hideOverlay(){$("#overlay").fadeOut();$("#overlay iframe").attr("src","");return!1}function home(){window.location.href="/"}function toggleMute(){player.muted=!player.muted;$("#bMute").attr("src","/i/audio_"+(player.muted?"on":"mute")+".png")}function toggleMode(){if($("#viz").offset().left<0){$("#bMode").attr("src","/i/mode_full.png");$("#viz").animate({"margin-left":0});$("#dia").animate({left:$("#viz").width()+60})}else{$("#bMode").attr("src","/i/mode_list.png");$("#viz").animate({"margin-left":-($("#viz").width()+60)});$("#dia").animate({left:0})}return!1}function updateEmbedCode(){var e="http://"+window.location.host+"/api/embed.js?ref="+encodeURIComponent(window.location.search.replace("?dir=",""))+"/"+window.location.hash.replace("#","")+"&w="+$("#embed_w").val()+"&h="+$("#embed_h").val()+"&l="+$("#embed_link").is(":checked")+"&d="+$("#embed_desc").is(":checked"),t='<script type="text/javascript">';t+="document.write(unescape(\"%3Cscript src=\\'"+e+"\\' type=\\'text/javascript\\'%3E%3C/script%3E\"));";t+="</script>";$("#embed_code").text(t)}function showEmbed(){updateEmbedCode();$("#embed, #embed .close").click(function(){hideEmbed()});$("#embed").fadeIn()}function hideEmbed(){$("#embed").fadeOut()}var currentSnd=-1,player=document.getElementById("player"),kFadeDuration=200,kDisableRightClick=window.location.href.indexOf("etalk.cc")===-1;window.location.hash?playTrack(window.location.hash.replace("#","")):setCurrentSnd(0);$(document).ready(function(){$("#diaPict").load(function(){$("#dia>figure").fadeIn()});$("#bBack").bind("click touchstart",function(e){e.preventDefault();home()});$("#bMode").bind("click touchstart",function(e){e.preventDefault();toggleMode()});$("#bPlay").bind("click touchstart",function(e){e.preventDefault();play()});$("#bPause").bind("click touchstart",function(e){e.preventDefault();pause(!1)});$("#bStop").bind("click touchstart",function(e){e.preventDefault();pause(!0)});$("#bNext").bind("click touchstart",function(e){e.preventDefault();next()});$("#bMute").bind("click touchstart",function(e){e.preventDefault();toggleMute()});$("#bShare").bind("click touchstart",function(e){e.preventDefault();showEmbed()});$("#embed>div").bind("click touchstart",function(e){e.stopPropagation()});$("#embed_code").bind("mouseup",function(){this.select()});$("#embed input").bind("input change",function(){updateEmbedCode()});$("#wait a.vidPlay").bind("click touchstart",function(e){e.preventDefault();play()});$("#wait>nav>a:not(.doc)").bind("click touchstart",function(e){e.preventDefault();playTrack($(this).attr("href").replace("#",""))});$("#overlay .close").bind("click touchstart",function(e){e.preventDefault();hideOverlay()});$("#viz>*").bind("dragstart",function(e){e.preventDefault()});$("#viz>a").bind("click touchstart",function(e){e.preventDefault();playTrack($(this).attr("href").replace("#",""))});if(kDisableRightClick){$(document.body).bind("contextmenu",function(e){e.preventDefault()});$(document.body).bind("mousedown",function(e){e.preventDefault()})}});
function fileSelected(e){var t,n=document.getElementById("f"+e).files[0],r=$.parseJSON($("#allowedTypes"+e).html());if(r.length>0&&r.indexOf(n.type)==-1){alert(kMsgWrongType+r+" ("+n.type+")");$("#f"+e).val()}else{t=0;n.size>1048576?t=(Math.round(n.size*100/1048576)/100).toString()+"MB":t=(Math.round(n.size*100/1024)/100).toString()+"KB";$("#f"+e).hide();$("#t"+e).show();$("#info"+e).html(t+" ("+n.type+")");$("#icon"+e).attr("src",kImageLoading);uploadFile(e,n)}}function uploadFile(e,t){var n,r=new FormData;r.append("fileName",t.name);r.append(document.getElementById("f"+e).name,t);n=new XMLHttpRequest;n.upload.addEventListener("progress",function(t){uploadProgress(t,e)},!1);n.addEventListener("load",function(t){uploadComplete(t,e)},!1);n.addEventListener("error",function(t){uploadFailed(t,e)},!1);n.addEventListener("abort",function(t){uploadCanceled(t,e)},!1);n.open("post","/upload.php?n="+$("#fNamePolicy"+e).val());n.send(r)}function uploadProgress(e,t){var n,r,i,s,o;if(e.lengthComputable){n=e.loaded;r=e.total;i=Math.round(e.loaded*100/e.total);if(n>102400){s=1048576;o="Mo"}else{s=1024;o="Ko"}$("#progressLabel"+t).html((Math.round(n*10/s)/10).toString()+"/"+(Math.round(r*10/s)/10).toString()+" "+o);$("#progressBar"+t).css("width",i.toString()+"%")}else $("#progressBar"+t).html(kProgressUnknown)}function uploadComplete(e,t){var n=$.parseJSON(e.target.responseText);if(n.status==1)showFile(t,n.file,!0);else{$("#icon"+t).attr("src",kImageError);alert(n.msg)}}function showFile(e,t,n){$("#sel"+e).hide();$("#rep"+e).show();$("#rep"+e+">.field").html('<a href="/tmp/'+t+'" rel="lightbox">'+t+"</a>");$("#fc"+e).hide();$("#fFileName"+e).val(t);$("#info"+e).html(t);if(n){$("#progressLabel"+e).html(kLabelComplete);$("#icon"+e).attr("src",kImageSuccess);$("#progressBar"+e).css("background",kColorProgressComplete)}}function resetFile(e){$("#sel"+e).show();$("#rep"+e).hide();$("#rep"+e+">.field").html("");$("#fFileName"+e).val("");$("#fc"+e).show();$("#f"+e).wrap("<form>").closest("form").get(0).reset();$("#f"+e).unwrap().show();$("#t"+e).hide();$("#info"+e).html("");$("#del"+e).val($("#fFileName"+e).attr("name"))}function uploadFailed(){alert(kMsgFail)}function uploadCanceled(){alert(kMsgInterrupt)}var kMsgInterrupt="Téléversement interrompu. Veuillez réessayer en sélectionnant à nouveau votre fichier.",kMsgFail="Une erreur est survenue lors du chargement.",kMsgWrongType="Mauvais type de fichier. Les formats suivants sont acceptés : ",kImageLoading="/i/loading.gif",kImageSuccess="/i/ok.png",kImageError="/i/error.png",kProgressUnknown="Chargement...",kColorProgressComplete="#888888",kLabelComplete="OK";Array.indexOf||(Array.prototype.indexOf=function(e){var t;for(t=0;t<this.length;t++)if(this[t]==e)return t;return-1});